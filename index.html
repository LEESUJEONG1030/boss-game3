<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì‚¬ í˜¼ë‚´ì£¼ê¸° ULTIMATE</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', sans-serif; background: linear-gradient(to bottom, #1a1a2e, #16213e); color: white; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .office { position: relative; background: linear-gradient(to bottom, #e0f2fe, #cbd5e1); height: 600px; border-radius: 10px; border: 3px solid #334155; overflow: hidden; }
        
        .desk { position: absolute; width: 50px; height: 35px; background: #92400e; border: 2px solid #78350f; border-radius: 3px; }
        .door { position: absolute; width: 50px; height: 70px; background: #78350f; border: 2px solid #000; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        
        .person { position: absolute; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; }
        .person:hover { transform: scale(1.05); }
        .head { width: 20px; height: 20px; background: #fbbf24; border-radius: 50%; border: 1.5px solid #000; position: relative; margin-bottom: 2px; }
        .head.boss { background: #ef4444; }
        .head.player { background: #10b981; }
        .head.bald { background: #ffc6a5; }
        .hair { position: absolute; top: -3px; left: 50%; transform: translateX(-50%); font-size: 12px; }
        .eyes { position: absolute; top: 6px; left: 5px; font-size: 6px; }
        .body { width: 18px; height: 25px; background: #3b82f6; border: 1.5px solid #000; border-radius: 3px; margin-bottom: 2px; position: relative; }
        .body.boss { background: #991b1b; }
        .body.player { background: #059669; }
        .body.fat { width: 28px; height: 30px; }
        .body.tall { height: 35px; }
        .arm { position: absolute; width: 20px; height: 4px; background: #fbbf24; border: 1px solid #000; top: 5px; }
        .arm.left { left: -15px; transform: rotate(-30deg); }
        .arm.right { right: -15px; transform: rotate(30deg); }
        .legs { display: flex; gap: 3px; }
        .leg { width: 6px; height: 18px; background: #1e3a8a; border: 1px solid #000; border-radius: 2px; }
        .leg.boss { background: #7f1d1d; }
        .leg.player { background: #065f46; }
        .leg.tall { height: 25px; }
        
        .label { position: absolute; bottom: -18px; font-size: 9px; padding: 2px 6px; border-radius: 4px; white-space: nowrap; font-weight: bold; }
        .boss-label { background: #dc2626; color: white; }
        .player-label { background: #10b981; color: white; }
        
        .ramen { position: absolute; top: -25px; right: -15px; font-size: 20px; z-index: 10; }
        .burp { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 18px; animation: float 1s ease-out; }
        @keyframes float { 0% { opacity: 1; transform: translateX(-50%) translateY(0); } 100% { opacity: 0; transform: translateX(-50%) translateY(-30px); } }
        
        .speech { position: absolute; background: white; color: black; padding: 5px 10px; border-radius: 10px; font-size: 11px; font-weight: bold; border: 2px solid #000; z-index: 120; white-space: nowrap; }
        .warning { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: #dc2626; padding: 10px 20px; border-radius: 8px; border: 2px solid #fbbf24; z-index: 100; display: none; font-size: 12px; }
        
        .weapon-popup { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 200; }
        .weapon-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .weapon-btn { background: #dc2626; border: 2px solid #fbbf24; padding: 15px; border-radius: 8px; cursor: pointer; color: white; }
        
        .hit { position: absolute; font-size: 50px; animation: explode 0.7s forwards; z-index: 150; pointer-events: none; }
        @keyframes explode { to { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        .knocked { animation: fall 0.6s forwards; }
        @keyframes fall { 0% { transform: rotate(0deg); } 100% { transform: rotate(90deg) translateY(15px); } }
        
        .shop { background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; margin-top: 15px; }
        .shop-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .shop-item { background: #374151; border: 2px solid #4b5563; padding: 10px; border-radius: 6px; text-align: center; font-size: 11px; }
        .buy-btn { width: 100%; margin-top: 6px; padding: 4px; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; }
        
        .stats { background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; margin-top: 15px; }
        .char-select { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 300; }
        .char-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .char-option { background: #374151; border: 3px solid #fbbf24; padding: 25px; border-radius: 12px; cursor: pointer; text-align: center; }
        
        .poop-floor { position: absolute; font-size: 40px; z-index: 5; animation: drop 0.5s forwards; }
        @keyframes drop { from { transform: translateY(-100px); } to { transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="char-select" id="charSelect">
        <div>
            <h2 style="text-align:center; font-size:28px; margin-bottom:30px; color:#fbbf24;">ìºë¦­í„° ì„ íƒ</h2>
            <div class="char-grid">
                <div class="char-option" onclick="start('ìƒë¹ˆ')"><div style="font-size:50px;">ğŸ§‘</div><div style="font-size:20px;">ìƒë¹ˆ</div></div>
                <div class="char-option" onclick="start('ë‚˜')"><div style="font-size:50px;">ğŸ‘©</div><div style="font-size:20px;">ë‚˜</div></div>
                <div class="char-option" onclick="start('í˜„ì•„')"><div style="font-size:50px;">ğŸ‘©</div><div style="font-size:20px;">í˜„ì•„</div></div>
                <div class="char-option" onclick="start('ì¤€í˜•')"><div style="font-size:50px;">ğŸ§‘</div><div style="font-size:20px;">ì¤€í˜•</div></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1 style="font-size:22px;">ğŸ¢ ìƒì‚¬ í˜¼ë‚´ì£¼ê¸° ULTIMATE</h1>
            <div><div>ğŸ’° <span id="coins">0</span></div><div>ğŸ’ª <span id="score">0</span></div><div>ğŸ‘Š <span id="hits">0</span>íšŒ</div></div>
        </div>

        <div class="warning" id="warn"></div>
        <div class="office" id="off"></div>

        <div class="weapon-popup" id="wpop">
            <div style="background:#374151; padding:30px; border-radius:12px;">
                <h2 style="text-align:center; margin-bottom:15px;">ğŸ¯ <span id="tname"></span> ê³µê²©!</h2>
                <div class="weapon-grid" id="wgrid"></div>
                <button onclick="closePop()" style="width:100%; margin-top:15px; padding:10px; background:#4b5563; border:none; border-radius:6px; color:white; cursor:pointer;">ì·¨ì†Œ</button>
            </div>
        </div>

        <div class="shop"><h3>ğŸ›’ ë¬´ê¸°</h3><div class="shop-grid" id="shop"></div></div>
        <div class="stats">
            <h3>ğŸ“Š í†µê³„</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:10px;">
                <div style="background:#374151; padding:10px; border-radius:8px;"><div style="color:#fbbf24; font-weight:bold;">í”Œë ˆì´ì–´</div><div id="ps"></div></div>
                <div style="background:#374151; padding:10px; border-radius:8px;"><div style="color:#fbbf24; font-weight:bold;">ìƒì‚¬ í”¼ê²©</div><div id="bs"></div></div>
            </div>
        </div>
    </div>

    <script>
        const G = {
            me: null, sc: 0, co: 0, hi: 0, tar: null,
            psc: {ìƒë¹ˆ:0, ë‚˜:0, í˜„ì•„:0, ì¤€í˜•:0},
            bhi: {ã„±ã…ˆ:0, ã…ˆã„¹:0, í›ˆë°œë†ˆ:0, ì¯”í—ˆ:0, ë°•24:0},
            pos: {ã„±ã…ˆ:{x:30,y:20}, ìƒë¹ˆ:{x:45,y:20}, ë‚˜:{x:60,y:20}, í˜„ì•„:{x:75,y:50}, ì¤€í˜•:{x:60,y:70}, í›ˆë°œë†ˆ:{x:50,y:90}, ì¯”í—ˆ:{x:85,y:90}},
            st: {ã„±ã…ˆ:{burp:0,talk:0,sneak:0}, ã…ˆã„¹:{out:0,ram:0}, ì¯”í—ˆ:{}, í›ˆë°œë†ˆ:{}, ë°•24:{out:0,poop:0}},
            wp: [{n:'ì£¼ë¨¹',d:10,i:'ğŸ‘Š',c:0},{n:'í‚¤ë³´ë“œ',d:20,i:'âŒ¨ï¸',c:50},{n:'ë§ˆìš°ìŠ¤',d:30,i:'ğŸ–±ï¸',c:100},{n:'ì»¤í”¼',d:50,i:'â˜•',c:200},{n:'ë…¸íŠ¸ë¶',d:80,i:'ğŸ’»',c:400},{n:'ì˜ì',d:120,i:'ğŸª‘',c:800}],
            own: [1,0,0,0,0,0]
        };

        function mkPerson(boss, n, type) {
            let hc = boss ? 'boss' : 'player', bc = 'body ' + hc, lc = 'leg ' + hc, hair = '';
            if (type === 'ã„±ã…ˆ' || type === 'í›ˆë°œë†ˆ') { bc += ' fat'; hair = '<div class="hair">ğŸ©</div>'; }
            else if (type === 'ã…ˆã„¹' || type === 'ì¯”í—ˆ') { hc += ' bald'; }
            if (type === 'ì¯”í—ˆ') { bc += ' tall'; lc += ' tall'; }
            return `<div class="head ${hc}">${hair}<div class="eyes">ğŸ‘€</div></div><div class="${bc}"><div class="arm left"></div><div class="arm right"></div></div><div class="legs"><div class="${lc}"></div><div class="${lc}"></div></div><div class="label ${boss?'boss-label':'player-label'}">${n}</div>`;
        }

        function start(c) {
            G.me = c;
            document.getElementById('charSelect').style.display = 'none';
            init();
        }

        function init() {
            const o = document.getElementById('off');
            o.innerHTML = '';
            
            // ë¬¸ë“¤
            const d1 = document.createElement('div');
            d1.className = 'door'; d1.style.left = '2%'; d1.style.top = '50%'; d1.textContent = 'ğŸšª'; d1.id = 'd1';
            o.appendChild(d1);
            
            const d2 = document.createElement('div');
            d2.className = 'door'; d2.style.left = '5%'; d2.style.top = '30%'; d2.textContent = 'ğŸšª'; d2.id = 'd2';
            o.appendChild(d2);
            
            // ì±…ìƒ
            Object.entries(G.pos).forEach(([n,p]) => {
                const dk = document.createElement('div');
                dk.className = 'desk'; dk.style.left = p.x + '%'; dk.style.top = p.y + '%';
                o.appendChild(dk);
            });
            
            // ìºë¦­í„°
            Object.entries(G.pos).forEach(([n,p]) => {
                const pr = document.createElement('div');
                pr.className = 'person'; pr.id = 'p-' + n;
                pr.style.left = p.x + '%'; pr.style.top = p.y + '%';
                pr.innerHTML = mkPerson(['ã„±ã…ˆ','í›ˆë°œë†ˆ','ì¯”í—ˆ'].includes(n), n, n);
                if (['ã„±ã…ˆ','í›ˆë°œë†ˆ','ì¯”í—ˆ'].includes(n)) pr.onclick = () => showW(n);
                o.appendChild(pr);
            });
            
            upd(); drawShop();
        }

        function tick() {
            // ã„±ã…ˆ ë§ê±¸ê¸°
            if (!G.st.ã„±ã…ˆ.talk && !G.st.ã„±ã…ˆ.sneak && Math.random() < 0.008) {
                G.st.ã„±ã…ˆ.talk = 1;
                const s = document.createElement('div');
                s.className = 'speech'; s.style.left = '35%'; s.style.top = '15%';
                s.textContent = ['ì•¼ ìƒë¹ˆì•„~','ìƒë¹ˆì´ ë­í•´?','ì–´ì œ ë­í–ˆì–´?'][Math.floor(Math.random()*3)];
                s.id = 'sp1';
                document.getElementById('off').appendChild(s);
                setTimeout(() => { const x = document.getElementById('sp1'); if(x) x.remove(); G.st.ã„±ã…ˆ.talk = 0; }, 3000);
            }
            
            // ã„±ã…ˆ ë’¤ë¡œ í›”ì³ë³´ê¸°
            if (!G.st.ã„±ã…ˆ.sneak && !G.st.ã„±ã…ˆ.talk && (G.me === 'ë‚˜' || G.me === 'ìƒë¹ˆ') && Math.random() < 0.01) {
                G.st.ã„±ã…ˆ.sneak = 1;
                const e = document.getElementById('p-ã„±ã…ˆ');
                const tp = G.pos[G.me];
                document.getElementById('warn').textContent = 'âš ï¸ ã„±ã…ˆì´ ë’¤ì—ì„œ í›”ì³ë³´ê³  ìˆì–´ìš”!';
                document.getElementById('warn').style.display = 'block';
                
                const iv = setInterval(() => {
                    const cx = parseFloat(e.style.left), cy = parseFloat(e.style.top);
                    const dx = (tp.x+5) - cx, dy = (tp.y+10) - cy;
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if (d < 2) {
                        clearInterval(iv);
                        setTimeout(() => {
                            e.style.left = '30%'; e.style.top = '20%';
                            G.st.ã„±ã…ˆ.sneak = 0;
                            document.getElementById('warn').style.display = 'none';
                        }, 2000);
                    } else {
                        e.style.left = (cx + dx/d * 0.3) + '%';
                        e.style.top = (cy + dy/d * 0.3) + '%';
                    }
                }, 100);
            }
            
            // ã„±ã…ˆ íŠ¸ë¦„ (ìƒë¹ˆì´ë§Œ ì… ë•Œë¦¼)
            if (G.me === 'ìƒë¹ˆ' && !G.st.ã„±ã…ˆ.burp && Math.random() < 0.01) {
                G.st.ã„±ã…ˆ.burp = 1;
                const e = document.getElementById('p-ã„±ã…ˆ');
                const b = document.createElement('div');
                b.className = 'burp'; b.textContent = 'ğŸ’¨'; b.id = 'brp';
                e.appendChild(b);
                
                // ìƒë¹ˆì´ë§Œ í´ë¦­ ê°€ëŠ¥
                const sb = document.getElementById('p-ìƒë¹ˆ');
                if (sb) {
                    sb.style.cursor = 'pointer';
                    sb.style.transform = 'scale(1.1)';
                    sb.onclick = () => {
                        if (G.st.ã„±ã…ˆ.burp) {
                            attack(0, 'ã„±ã…ˆ');
                            G.psc.ìƒë¹ˆ += 50;
                            const h = document.createElement('div');
                            h.className = 'hit'; h.textContent = 'ğŸ‘‹ğŸ’¥ì…ì‹¸ëŒ€ê¸°!';
                            h.style.left = '30%'; h.style.top = '20%';
                            document.getElementById('off').appendChild(h);
                            setTimeout(() => h.remove(), 700);
                            sb.style.cursor = 'default';
                            sb.style.transform = 'scale(1)';
                            sb.onclick = null;
                        }
                    };
                }
                
                setTimeout(() => {
                    const x = document.getElementById('brp'); if(x) x.remove();
                    G.st.ã„±ã…ˆ.burp = 0;
                    if (sb) {
                        sb.style.cursor = 'default';
                        sb.style.transform = 'scale(1)';
                        sb.onclick = null;
                    }
                    e.onclick = () => showW('ã„±ã…ˆ');
                }, 3000);
            }
            
            // ã…ˆã„¹ ë°©ì—ì„œ ë‚˜ì˜¤ê¸° (í™•ë¥  ë†’ì„)
            if (!G.st.ã…ˆã„¹.out && Math.random() < 0.03) {
                G.st.ã…ˆã„¹.out = 1;
                G.st.ã…ˆã„¹.ram = Math.random() < 0.5 ? 1 : 0;
                const pr = document.createElement('div');
                pr.className = 'person'; pr.id = 'p-ã…ˆã„¹';
                pr.style.left = '15%'; pr.style.top = '30%';
                pr.innerHTML = mkPerson(1, 'ã…ˆã„¹', 'ã…ˆã„¹');
                if (G.st.ã…ˆã„¹.ram) {
                    const r = document.createElement('div');
                    r.className = 'ramen'; r.textContent = 'ğŸœ'; r.id = 'ram';
                    pr.appendChild(r);
                }
                pr.onclick = () => {
                    if (G.st.ã…ˆã„¹.ram) {
                        // ë¼ë©´ ë–¨ì–´ëœ¨ë¦¬ê¸° + ì—ì–´ì§ + ìš¸ìŒ
                        G.st.ã…ˆã„¹.ram = 0;
                        G.psc[G.me] += 30; G.co += 30; upd();
                        
                        // ë¼ë©´ ì œê±°
                        const x = document.getElementById('ram'); if(x) x.remove();
                        
                        // ì—ì–´ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
                        pr.style.transform = 'rotate(90deg) translateY(15px)';
                        
                        // ìš¸ìŒ
                        const cry = document.createElement('div');
                        cry.className = 'speech';
                        cry.style.left = pr.style.left;
                        cry.style.top = (parseFloat(pr.style.top) - 8) + '%';
                        cry.textContent = 'ğŸ˜­ ìœ¼ì•„ì•„ì•™!';
                        cry.id = 'cry';
                        document.getElementById('off').appendChild(cry);
                        
                        // íƒ€ê²© ì´í™íŠ¸
                        const h = document.createElement('div');
                        h.className = 'hit'; h.textContent = 'ğŸœğŸ’¥';
                        h.style.left = pr.style.left; h.style.top = pr.style.top;
                        document.getElementById('off').appendChild(h);
                        setTimeout(() => h.remove(), 700);
                        
                        // 1.5ì´ˆ í›„ ì¼ì–´ë‚¨
                        setTimeout(() => {
                            pr.style.transform = '';
                            const c = document.getElementById('cry');
                            if (c) c.remove();
                        }, 1500);
                    } else { 
                        showW('ã…ˆã„¹'); 
                    }
                };
                document.getElementById('off').appendChild(pr);
                
                // ã…ˆã„¹ ëŒì•„ë‹¤ë‹ˆê¸° + ë¼ë©´ ëœë¤
                setInterval(() => {
                    if (G.st.ã…ˆã„¹.out) {
                        const p = document.getElementById('p-ã…ˆã„¹');
                        if(p) { 
                            p.style.left = (Math.random()*70+15)+'%'; 
                            p.style.top = (Math.random()*50+25)+'%'; 
                            
                            // ê°€ë” ë¼ë©´ ì¶”ê°€/ì œê±°
                            if (Math.random() < 0.3) {
                                const hasRam = document.getElementById('ram');
                                if (!hasRam && Math.random() < 0.5) {
                                    G.st.ã…ˆã„¹.ram = 1;
                                    const r = document.createElement('div');
                                    r.className = 'ramen'; r.textContent = 'ğŸœ'; r.id = 'ram';
                                    p.appendChild(r);
                                } else if (hasRam && Math.random() < 0.3) {
                                    G.st.ã…ˆã„¹.ram = 0;
                                    hasRam.remove();
                                }
                            }
                        }
                    }
                }, 2000);
            }
            
            // ì¯”í—ˆ
            const z = document.getElementById('p-ì¯”í—ˆ');
            if (z && Math.random() < 0.015) {
                const tg = ['ìƒë¹ˆ','í˜„ì•„','ì¤€í˜•'][Math.floor(Math.random()*3)];
                const tp = G.pos[tg];
                z.style.left = (tp.x+5) + '%'; z.style.top = (tp.y+10) + '%';
                const s = document.createElement('div');
                s.className = 'speech'; s.style.left = z.style.left; s.style.top = (parseFloat(z.style.top)-8)+'%';
                s.textContent = (tg==='ìƒë¹ˆ'||tg==='í˜„ì•„') ? 'í™”ì´íŒ…! ğŸ’ª' : 'ì˜ë˜ê°€? ğŸ˜';
                document.getElementById('off').appendChild(s);
                setTimeout(() => s.remove(), 3000);
            }
            
            // í›ˆë°œë†ˆ ëŒì•„ë‹¤ë‹ˆê¸°
            const hb = document.getElementById('p-í›ˆë°œë†ˆ');
            if (hb && Math.random() < 0.02) {
                hb.style.left = (Math.random() * 70 + 15) + '%';
                hb.style.top = (Math.random() * 50 + 40) + '%';
            }
            
            // ë°•24 ë“±ì¥ (í™•ë¥  ë†’ì„)
            if (!G.st.ë°•24.out && Math.random() < 0.01) {
                G.st.ë°•24.out = 1;
                const pr = document.createElement('div');
                pr.className = 'person'; pr.id = 'p-ë°•24';
                pr.style.left = '8%'; pr.style.top = '50%';
                pr.innerHTML = mkPerson(1, 'ë°•24ğŸ’©', null);
                pr.onclick = () => gangbeat();
                document.getElementById('off').appendChild(pr);
                
                // ë˜¥ íˆ¬ì²™
                setTimeout(() => {
                    if (G.st.ë°•24.out) {
                        G.st.ë°•24.poop = 1;
                        const p = document.createElement('div');
                        p.className = 'poop-floor'; 
                        p.textContent = 'ğŸ’©ğŸ’©ğŸ’©';
                        p.style.position = 'absolute';
                        p.style.left = '30%'; 
                        p.style.top = '60%';
                        p.style.fontSize = '40px';
                        p.style.zIndex = '50';
                        p.style.animation = 'drop 0.5s forwards';
                        p.id = 'poop-floor';
                        document.getElementById('off').appendChild(p);
                    }
                }, 1000);
                
                setTimeout(() => {
                    const x = document.getElementById('p-ë°•24');
                    if(x) x.remove();
                    const pf = document.getElementById('poop-floor');
                    if(pf) pf.remove();
                    G.st.ë°•24.out = 0; 
                    G.st.ë°•24.poop = 0;
                }, 10000);
            }
        }

        function gangbeat() {
            const all = ['ìƒë¹ˆ','ë‚˜','í˜„ì•„','ì¤€í˜•'];
            all.forEach((n,i) => {
                setTimeout(() => {
                    const p = document.getElementById('p-'+n);
                    if(p) {
                        p.style.transition = 'all 1s ease-out';
                        p.style.left = '8%';
                        p.style.top = '50%';
                        setTimeout(() => {
                            p.style.transition = 'all 0.8s ease-in';
                            p.style.left = G.pos[n].x + '%';
                            p.style.top = G.pos[n].y + '%';
                        }, 1500);
                    }
                }, i*400);
            });
            
            setTimeout(() => {
                attack(0, 'ë°•24');
                const h = document.createElement('div');
                h.className = 'hit'; h.textContent = 'ğŸ‘ŠğŸ‘ŠğŸ‘Šë‹¤êµ´!';
                h.style.left = '8%'; h.style.top = '50%';
                document.getElementById('off').appendChild(h);
                setTimeout(() => h.remove(), 700);
                
                const x = document.getElementById('p-ë°•24');
                if(x) x.remove();
                G.st.ë°•24.out = 0;
            }, 3000);
        }

        function showW(n) {
            G.tar = n;
            document.getElementById('tname').textContent = n;
            const gr = document.getElementById('wgrid');
            gr.innerHTML = '';
            G.wp.forEach((w,i) => {
                if (G.own[i]) {
                    const b = document.createElement('button');
                    b.className = 'weapon-btn';
                    b.innerHTML = `<div style="font-size:30px;">${w.i}</div><div>${w.n}</div><div style="color:#fbbf24;">ğŸ’¥${w.d}</div>`;
                    b.onclick = () => attack(i);
                    gr.appendChild(b);
                }
            });
            document.getElementById('wpop').style.display = 'flex';
        }

        function closePop() { document.getElementById('wpop').style.display = 'none'; }

        function attack(i, boss) {
            const w = G.wp[i], b = boss || G.tar;
            G.sc += w.d; G.co += w.d; G.hi++;
            G.psc[G.me] += w.d; G.bhi[b]++;
            upd(); drawShop();
            
            const e = document.getElementById('p-' + b);
            if (e) {
                e.classList.add('knocked');
                const h = document.createElement('div');
                h.className = 'hit'; h.textContent = w.i + 'ğŸ’¥';
                h.style.left = e.style.left; h.style.top = e.style.top;
                document.getElementById('off').appendChild(h);
                setTimeout(() => h.remove(), 700);
                setTimeout(() => {
                    e.classList.remove('knocked');
                    // ã„±ã…ˆ ì›ìœ„ì¹˜
                    if (b === 'ã„±ã…ˆ') {
                        e.style.left = '30%';
                        e.style.top = '20%';
                        G.st.ã„±ã…ˆ.sneak = 0;
                        document.getElementById('warn').style.display = 'none';
                    }
                }, 600);
            }
            closePop();
        }

        function buy(i) {
            const w = G.wp[i];
            if (G.co >= w.c && !G.own[i]) {
                G.co -= w.c; G.own[i] = 1;
                upd(); drawShop();
            }
        }

        function upd() {
            document.getElementById('score').textContent = G.sc;
            document.getElementById('coins').textContent = G.co;
            document.getElementById('hits').textContent = G.hi;
            document.getElementById('ps').innerHTML = Object.entries(G.psc).sort((a,b)=>b[1]-a[1]).map(([n,s])=>`<div style="font-size:12px;">${n}: ${s}</div>`).join('');
            document.getElementById('bs').innerHTML = Object.entries(G.bhi).sort((a,b)=>b[1]-a[1]).map(([n,h])=>`<div style="font-size:12px;">${n}: ${h}íšŒ</div>`).join('');
        }

        function drawShop() {
            const gr = document.getElementById('shop');
            gr.innerHTML = '';
            G.wp.forEach((w,i) => {
                const d = document.createElement('div');
                d.className = 'shop-item';
                d.innerHTML = `<div style="font-size:22px;">${w.i}</div><div>${w.n}</div><div style="color:#fbbf24; font-size:10px;">ğŸ’¥${w.d}</div>`;
                if (!G.own[i]) {
                    const b = document.createElement('button');
                    b.className = 'buy-btn';
                    b.textContent = 'ğŸ’°'+w.c;
                    b.disabled = G.co < w.c;
                    b.style.background = G.co >= w.c ? '#10b981' : '#4b5563';
                    b.style.color = 'white';
                    b.onclick = () => buy(i);
                    d.appendChild(b);
                } else {
                    d.innerHTML += '<div style="color:#10b981; margin-top:6px; font-size:10px;">âœ…</div>';
                }
                gr.appendChild(d);
            });
        }

        setInterval(tick, 100);
    </script>
</body>
</html>
